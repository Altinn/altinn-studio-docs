<!DOCTYPE html>
<html lang="nb" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Best practice for PostgreSQL" />
<meta name="altinn_pagedir" class="elastic" content="community/contributing/handbook/postgres/" />
<meta name="altinn_title" class="elastic" content="Best practice for PostgreSQL" />



<title>Best practice for PostgreSQL â€“ Altinn</title><link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">

    <link href="/css/fortawesome.css" rel="stylesheet">
    <link href="/css/designsystem.css" rel="stylesheet"><link href="/css/theme.css" rel="stylesheet"><script src="/js/jquery-2.x.min.js"></script>
<link href="/css/custom.css" rel="stylesheet">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114303148-1"></script>
<script>
var host = window.location.hostname;
if(host != "localhost")
{
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-114303148-1', { 'anonymize_ip': true });
}
</script>

<script>
if (window.location.hostname != "localhost") {
    
    var script = document.createElement('script');
    script.async = true;
    script.src = 'https://siteimproveanalytics.com/js/siteanalyze_6255470.js';
    document.head.appendChild(script);
}
</script><style>
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>
  </head>
  <body class="a-page" data-url="/nb/community/contributing/handbook/postgres/best-practice-postgresql/"><nav class="a-jumpnav">
  <ul class="no-decoration d-flex">
    <li><a class="sr-only sr-only-focusable" href="#content">Hopp til hovedinnholdet</a></li><li><a class="sr-only sr-only-focusable" href="#docsmenu">Hopp til hovedmeny</a></li></ul>
</nav>

<header class="a-header ">
  
  <div class="container">
    <div class="row">
      <div class="col-12">

        
        <nav class="a-globalNav " id="primary-nav">
          <a href="/nb/" class="a-globalNav-logo">
            <img src="/images/altinn-new-logo-white.svg" alt="Altinn logo" class="adocs-logo">
            <span class="sr-only">Til forsiden</span>
          </a>

          <button class="navbar-toggler d-md-none" type="button"><span class="sr-only">Vis/skjul meny</span></button>

          <div class="collapse navbar-toggleable-sm a-globalNav-main" id="exCollapsingNavbar2">
            <ul id="exCollapsingNavbar">
              <li class="nav-item dropdown d-md-block"><a class="nav-link dropdown-toggle a-languageSwitcher" aria-expanded="false" data-toggle="dropdown" aria-haspopup="true" href="#">
  <span>Produkt</span>
</a>
<div class="dropdown-menu a-dropdown-languages a-dropdownTriangle">
    <a aria-hidden="true" class="dropdown-item" href="/nb/altinn-studio/v8/">
      <p class="product-item">Altinn Studio</p>
    </a>
    <a aria-hidden="true" class="dropdown-item" href="/nb/authorization/">
      <p class="product-item">Autorisasjon</p>
    </a>
    <a aria-hidden="true" class="dropdown-item" href="/nb/dialogporten/">
      <p class="product-item">Dialogporten</p>
    </a>
    <a aria-hidden="true" class="dropdown-item" href="/nb/broker/">
      <p class="product-item">Formidling</p>
    </a>
    <a aria-hidden="true" class="dropdown-item" href="/nb/events/">
      <p class="product-item">Events</p>
    </a>
    <a aria-hidden="true" class="dropdown-item" href="/nb/correspondence/">
      <p class="product-item">Melding</p>
    </a>
    <a aria-hidden="true" class="dropdown-item" href="/nb/notifications/">
      <p class="product-item">Varsling</p>
    </a>
</div>
</li>
              <li>
                <a class="a-nav-link a-hvr-underline " href="/nb/api/">api</a>
              </li>
              <li>
                <a class="a-nav-link a-hvr-underline " href="/nb/community/">community</a>
              </li>
            </ul>
          </div>
        </nav> 

        <ul class="nav nav-pills a-header-options" id="nav-list">
           <li class="nav-item d-md-block">
              <button id="search-button" class="nav-link adocs-toggle-search" type="button"
                  data-toggle="collapse" data-target="#collapseSearchContent" aria-expanded="false" aria-controls="collapseSearchContent"
                  onclick="setTimeout(function(){document.getElementsByClassName('pagefind-ui__search-input')[0].focus()},100); return true;">
                  <span>
                      <i class="ai ai-search">
                        <span class="sr-only">SÃ¸k</span></i>
                  </span>
              </button>
          </li>
          <li class="nav-item dropdown d-md-block"><a class="nav-link dropdown-toggle a-languageSwitcher" aria-expanded="false" data-toggle="dropdown" aria-haspopup="true" href="#">
  <img src="/images/nb.svg" class="" alt="Language" style="height: 1.2em; vertical-align: bottom;"/>
</a>
<div class="dropdown-menu a-dropdown-languages a-dropdownTriangle" style="z-index:100000;"><a aria-hidden="true" class="dropdown-item" href="/nb/community/contributing/handbook/postgres/best-practice-postgresql/">
      <img src="/images/nb.svg" class="a-iconLeft a-flag" alt="" />
      <p>
        <span class="a-h3">BokmÃ¥l âœ“</span><br></p>
    </a></div>
</li>
        </ul>

      </div>
    </div> 
  </div> 
</header>

<div id="collapseSearchContent" class="a-collapseContent adocs-collapseSearch collapse">
  <div class="a-collapseContent-inside px-0">
    <div class="bg-white pt-3 pb-3"><div class="container">
    <div class="row">
         
        <div class="form-group a-form-group a-form-group-large col-sm-12">
            <label class="a-h2" for="search-by">Hva leter du etter?</label>
            <div id="search-by" style="margin: auto;" class=""></div>
        </div>
        <link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
        <script src="/pagefind/pagefind-ui.js"></script>
        <script>
            window.addEventListener('DOMContentLoaded', (event) => {
                new PagefindUI({
                    element: "#search-by",
                    pageSize: 10,
                    excerptLength: 25,
                    showSubResults: true,
                    resetStyles: true,
                    showImages: true,
                    processResult: function (result) {
                        if (result?.meta?.image) {
                            let resultBase = new URL(result.url, window.location);
                            let remappedImage = new URL(result.meta.image, resultBase);
                            if (remappedImage.hostname !== window.location.hostname) {
                                result.meta.image = remappedImage.toString();
                            } else {
                                result.meta.image = remappedImage.pathname;
                            }
                        }
                    }
                });
                
                var searchField = document.getElementsByClassName("pagefind-ui__search-input")[0];
                if (searchField) {
                    searchField.setAttribute('aria-label', 'SÃ¸k');
                }

                var sKey = "as";
                searchField.addEventListener("blur", () => {
                    sessionStorage.setItem(sKey, searchField.value);
                });

                var searchButton = document.getElementById("search-button");
                searchButton.addEventListener("click", () => {
                    var scrollContainer = document.getElementsByClassName('adocs-scrollcontainer')[0];
                    if (!searchField.checkVisibility()) {
                        scrollContainer.setAttribute('style', 'visibility: hidden !important');
                    } else {
                        scrollContainer.removeAttribute('style');
                    }
                }); 
                
                if (sessionStorage.getItem(sKey)) {
                    searchField.value = sessionStorage.getItem(sKey);
                    searchField.dispatchEvent(new Event("input"));
                }
            });
        </script>
        <style>
          :root {
            --pagefind-ui-scale: 0.9;
            --pagefind-ui-text: #000000;
            --pagefind-ui-border: #1EAEF7;
            --pagefind-ui-border-radius: 0;
          }
          .pagefind-ui__search-input::placeholder {
            color: #757575 !important;
            opacity: 1 !important;
            font-weight: normal !important;
          }
          .pagefind-ui__result-link:hover, .pagefind-ui__result-link:hover {
            text-decoration: none !important;
          }
          .pagefind-ui__form:before {
            opacity: 1 !important;
          }
        </style>
        
    </div>
</div></div>
  </div>
</div>
<div class="container pt-2 pt-md-3 pt-lg-5">      
      <div class="adocs-scrollcontainer">
        <div class="row">
          <div class="col-sm-12 col-md-10 last-modified">Sist endret: 29. sep. 2025</div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-10"><nav id="sidebar" class=""><div class="highlightable">
  <ul id="docsmenu" class="topics">
      <li class="dd-item">
        <a href="/nb/community/"><span>Community</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/about/"><span>Om</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/about/open-source/"><span>Ã…pen kildekode</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/about/goals/"><span>MÃ¥l</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/"><span>Bidra til utvikling</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/propose-component/"><span>ForeslÃ¥ en ny komponent</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/develop-component/"><span>Utvikle en komponent</span></a></li><li class="dd-item">
          <a href="/nb/community/contributing/intro/">
            <span>Intro for utviklere</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/"><span>HÃ¥ndbok</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/azure-devops/"><span>Azure DevOps</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/azure-devops/pipelines/"><span>Pipelines</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/azure-storage/"><span>Azure Storage</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/azure-storage/tools/"><span>Tools &amp; Software</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/azure-storage/queues/"><span>Queues</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/back-end/"><span>Back-end</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/back-end/app-template-and-deps/"><span>App template and deps</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/back-end/async-programming/"><span>Async programming</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/back-end/error-flow/"><span>Error flow</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/back-end/exception-handling/"><span>Exception handling</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/back-end/logging/"><span>Logging</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/back-end/nuget-package/"><span>NuGet Package</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/back-end/swagger/"><span>Swagger</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/general/"><span>Cheat Sheet</span></a></li><li class="dd-item">
          <a href="/nb/community/contributing/handbook/cosmosdb/">
            <span>Cosmos DB</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/deployment/"><span>Deployment</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/docker/"><span>Docker</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul><li class="dd-item">
          <a href="/nb/community/contributing/handbook/docker/with-docker-desktop/">
            <span>Install Docker with Docker Desktop</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/docker/without-docker-desktop/"><span>Install Docker without Docker Desktop</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul><li class="dd-item">
          <a href="/nb/community/contributing/handbook/docker/without-docker-desktop/macos/">
            <span>macOS</span></a></li><li class="dd-item">
          <a href="/nb/community/contributing/handbook/docker/without-docker-desktop/windows/">
            <span>Windows</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/"><span>Front-end</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/getting-started/"><span>Getting started</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/studio-component/"><span>Studio components</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/developing/"><span>Developing locally</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/routine/"><span>Routines for development</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/new-component/"><span>Creating components</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/react/"><span>React</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/redux/"><span>Redux</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/debug/"><span>Debug</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/best-practices/"><span>Best practices</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/build/"><span>Build</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/component-library/"><span>Component Library</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/error-handling/"><span>Error handling</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/postmessage/"><span>Post Message</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/styling/"><span>Styling (css)</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/front-end/versioning/"><span>Versioning</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/cheatsheet/"><span>General</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/getting-started/"><span>Getting started</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/git/"><span>Git</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/naming/"><span>Naming Conventions</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/loadbalancer/"><span>Nginx loadbalancing in studio</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/loadbalancer/ssl-certificate/"><span>Nginx SSL/TLS certificate</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/postgres/"><span>PostgreSQL</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul><li class="dd-item">
          <a href="/nb/community/contributing/handbook/postgres/best-practice-postgresql/">
            <span>Best practice</span></a></li><li class="dd-item">
          <a href="/nb/community/contributing/handbook/postgres/sample-queries/">
            <span>Sample queries</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/rest/"><span>RESTful APIs (Representation State Transfer)</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/routing/"><span>Routing</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/routing/nginx/"><span>Nginx routing</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/routing/traefik/"><span>Traefik routing</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/routing/traefik/installation/"><span>Installation of Traefik 2.0</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/routing/traefik/tls-configuration/"><span>TLS in Traefik 2.0</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/routing/traefik/custom-resources/"><span>Traefik custom resources</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/routing/traefik/ingress-routes/"><span>Traefik ingress routes</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/securecoding/"><span>Secure DevOps</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/test/"><span>Test</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/test/automated-test-app/"><span>App for automated test</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/test/cypress/"><span>Cypress</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/test/k6/"><span>k6</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/test/postman/"><span>Postman</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/test/test-strategy/"><span>Test Strategy</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/test/unit-testing/"><span>Unit testing</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/test/xunit-testing/"><span>Xunit Testing</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/branching/"><span>Branching and Pull Requests</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/flight-rules/"><span>Flight Rules</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/gitea/"><span>Gitea</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/reusable-resources/"><span>Reusable resources</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/theming/"><span>Theming and styling</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/troubleshooting/"><span>Troubleshooting</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/"><span>Endringslogg</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/"><span>App frontend</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/v4/"><span>v4</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/v4/migrating-from-v3/"><span>Migrering fra v3</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/v3/"><span>v3</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/v3/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/v3/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/stricter-schema/"><span>JsonSchema</span></a></li><li class="dd-item">
          <a href="/nb/community/changelog/app-frontend/designsystem-update/">
            <span>Visuelle endringer</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/"><span>App nuget</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v8/"><span>v8</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v8/migrating-from-v7/"><span>Migrering fra v7</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v7/"><span>v7</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v7/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v7/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v6/"><span>v6</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v6/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v6/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v5/"><span>v5</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v5/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v5/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v4/"><span>v4</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v4/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v4/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v3/"><span>v3</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v3/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v3/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/older/"><span>Older</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/older/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/older/whats-new/"><span>What&#39;s new</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/"><span>Deployment</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/migration/"><span>Migrering</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v1/"><span>v1</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v1/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v1/whats-new/"><span>Hva er nytt</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v2/"><span>v2</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v2/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v2/whats-new/"><span>Hva er nytt</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v3/"><span>v3</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v3/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v3/whats-new/"><span>Hva er nytt</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/storage-interfaces/"><span>Storage Interface</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/storage-interfaces/v3/"><span>v3</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/storage-interfaces/v2/"><span>v2</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/roadmap/"><span>Roadmap</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/"><span>DevOps</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/devops/definition-of-ready/"><span>Definition of Ready</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/roadmapprocess/"><span>Roadmap prosess</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/"><span>Teams</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/apps/"><span>Apps</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/authorization/"><span>Autorisasjon</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/authorization/designfrontendprocess/"><span>Desgin/Frontend prosess</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/platform/"><span>Platform</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/studio/"><span>Studio</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/presentations/"><span>Presentasjoner</span></a></li></ul></li></ul>
</div>
</nav>

<script>
          $("li.dd-item a[href='/nb/community/']").parent().addClass("parent");
 $("li.dd-item a[href='/nb/community/contributing/']").parent().addClass("parent");
 $("li.dd-item a[href='/nb/community/contributing/handbook/']").parent().addClass("parent");
 $("li.dd-item a[href='/nb/community/contributing/handbook/postgres/']").parent().addClass("parent");
 $("li.dd-item a[href='/nb/community/contributing/handbook/postgres/best-practice-postgresql/']").parent().addClass("active");
        </script>
        <section id="body">
          <div id="content" class="adocs-content js-moveChildrenTo">
        <div id="overlay"></div>
        <div class="a-text"><div id="top-bar">            
            <div id="breadcrumbs">
                <span id="sidebar-toggle-span" class="adocs-sidebarToggle">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                    <span class="sr-only">Vis/skjul meny</span>
                  </a>
                </span>
                <span class="links" data-pagefind-meta="ðŸž"><a href='/nb/community/'>Community</a> <span class='adocs-breadcrumb-divider'> / </span> <a href='/nb/community/contributing/'>Bidra til utvikling</a> <span class='adocs-breadcrumb-divider'> / </span> <a href='/nb/community/contributing/handbook/'>HÃ¥ndbok</a> <span class='adocs-breadcrumb-divider'> / </span> <a href='/nb/community/contributing/handbook/postgres/'>PostgreSQL</a> <span class='adocs-breadcrumb-divider'> / </span> Best practice</span>
            </div>            
          </div><div id="body-inner" data-pagefind-body><h1 class="a-fontBold">Best practice for PostgreSQL</h1>
              <p class="a-leadText" id="leadText">Best practice for PostgreSQL</p>

<h2 id="introduction">Introduction</h2>
<p>This is a work-in-progress. Reader discretion is adviced!</p>
<h2 id="client-library">Client library</h2>
<p>Use the newest Npgsql library - ref <a href="https://www.npgsql.org/doc/">documentation</a> for nuget package
and recommended use. Make sure to use NpgsqlDataSource that was introduced in Npgsql 7.0.</p>
<p>Configure npgsql with DI as described <a href="https://github.com/npgsql/npgsql/issues/4503">here</a>
(missing in the standard docs at the time of writing).</p>
<h2 id="commands-npgsql">Commands (Npgsql)</h2>
<ol>
<li>Do not concatenate User-Defined types as strings into the SQL commands. <em>(SQL injection preventation)</em></li>
</ol>
<h2 id="parameters">Parameters</h2>
<ol>
<li>Use <em>parameters</em> instead of embedding values in the SQL.
<ul>
<li>Values sent as parameters will not be interpreted as SQL. <em>(SQL injection preventation)</em></li>
<li>Parameters are required for <em>prepared statements</em>. <em>(Performance)</em>
<a href="https://www.npgsql.org/doc/basic-usage.html#parameters">Parameters | Npgsql Documentation</a></li>
</ul>
</li>
<li>Use <em>positional</em> parameter notation instead of <em>named</em>. <em>(Performance)</em>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#ff79c6">await</span> <span style="color:#ff79c6">using</span> var cmd = <span style="color:#ff79c6">new</span> NpgsqlCommand(<span style="color:#f1fa8c">&#34;INSERT INTO table (col1) VALUES ($1), ($2)&#34;</span>, conn)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Parameters =
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">new</span>() { Value = <span style="color:#f1fa8c">&#34;some_value&#34;</span> },
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">new</span>() { Value = <span style="color:#f1fa8c">&#34;some_other_value&#34;</span> }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">await</span> cmd.ExecuteNonQueryAsync();
</span></span></code></pre></div><a href="https://www.npgsql.org/doc/basic-usage.html#positional-and-named-placeholders">Positional and named placeholders | Npgsql Documentation</a></li>
</ol>
<h2 id="functions-stored-procedures">Functions (Stored Procedures)</h2>
<ul>
<li>The difference between Postgres <em>functions</em> and <em>stored procedures</em> (after Postgres 11) is relatively small, and mostly related to functionality - not security or performance.</li>
<li>Calling a function instead of embedding the SQL in a Npgsql command in C# will not prevent SQL injection attacks alone. (See <em>Parameters</em>)</li>
<li>If a function calls an unsafe function from its body, and pass a parameter value to the it, it could negate the SQL injection prevention that <em>parameters</em> provide.</li>
</ul>
<h2 id="prepared-statements">Prepared statements</h2>
<ol>
<li>Use prepared statements when you need performance.</li>
<li>Use <em>persistent</em> prepared statements (Npgsql 3.2) to avoid <em>resets</em> when connections are closed, when using connection pooling.</li>
</ol>
<ul>
<li><a href="https://www.roji.org/prepared-statements-in-npgsql-3-2">Prepared Statements, Connection Pooling and Npgsql 3.2</a></li>
<li><a href="https://www.npgsql.org/doc/prepare.html">Prepared Statements | Npgsql Documentation</a></li>
</ul>
<h2 id="analyze-queries">Analyze queries</h2>
<p><a href="https://www.postgresql.org/docs/current/sql-explain.html">Review explain documentation</a></p>
<h3 id="analyze-sql-statement">Analyze sql statement</h3>
<p>In your query window: Write &ldquo;explain analyze&rdquo; followed by our query. E.g.
<p><img alt="Simple query" src="../simple-query.png"></p></p>
<h3 id="analyze-procedure-or-function">Analyze procedure or function</h3>
<ul>
<li>Make sure that auto_explain is configured on the server and that Postgres version &gt;= 15.x
<p><img alt="Auto explain" src="../auto-explain.png"></p></li>
<li>Do the following in your query window</li>
</ul>
<pre tabindex="0"><code>SET auto_explain.log_min_duration = 0;
SET auto_explain.log_analyze = true;
SET auto_explain.log_nested_statements = ON;
SET auto_explain.log_level = INFO;
</code></pre><ul>
<li>Run your procedure or function. NB: The analysis result will be in the Messages tab.
<p><img alt="Analyze function" src="../analyze-function.png"></p></li>
</ul>
<h3 id="index-analysis">Index analysis</h3>
<p>Make sure that a proper index is used in the explained query plan. Try to add a new index if a proper candidate is missing.
Some times it&rsquo;s hard to make Postgres use your index.
<a href="https://www.postgresql.org/docs/current/indexes-examine.html">Review index documentation</a>.</p>
<h2 id="json-usage">Json usage</h2>
<h3 id="json-as-db-parameter">Json as db parameter</h3>
<p>When using logical json documents as database parameters and/or result sets always use jsonb
as the data type to avoid unnecessary conversion between text and the binary representation of jsonb.</p>
<h4 id="input-parameter-example">Input parameter example</h4>
<p>Npgsql will do the json conversion. Procedure signature:</p>
<pre tabindex="0"><code>CREATE PROCEDURE xx(_instance JSONB)
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Instance instance
</span></span><span style="display:flex;"><span>pgcom.Parameters.AddWithValue(NpgsqlDbType.Jsonb, instance);
</span></span></code></pre></div><h4 id="output-parameter-example">Output parameter example</h4>
<p>Npgsql will do the json conversion. Function signature:</p>
<pre tabindex="0"><code>RETURNS TABLE (instance JSONB)
</code></pre><p>C#:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Instance instance = reader.GetFieldValue&lt;Instance&gt;(<span style="color:#f1fa8c">&#34;instance&#34;</span>);
</span></span></code></pre></div><h2 id="db-columns-with-code-values-logical-enums">DB columns with code values (logical enums)</h2>
<p>Never define a column with fixed values to be of type text. Use integer or define a custom data type in the database.
Use an enum in the C# code. Enums in PostgreSQL have limitations and in some cases an
integer as db type would be a better choice.</p>
<h3 id="custom-data-type-enum-in-the-database">Custom data type (enum) in the database</h3>
<ul>
<li>Enums data types are not transferred as integers between client and db, and the built
in support for type mapping requires explicit type mapping, so the simplest solution is
to transfer the values as text.</li>
<li>Define a custom data type e.g.:</li>
</ul>
<pre tabindex="0"><code>CREATE TYPE emailnotificationresulttype AS ENUM (&#39;New&#39;, &#39;Sending&#39;, &#39;Succeeded&#39;, &#39;Failed_RecipientNotIdentified&#39;);
</code></pre><ul>
<li>This will match:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">enum</span> EmailNotificationResultType
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    New,
</span></span><span style="display:flex;"><span>    Sending,
</span></span><span style="display:flex;"><span>    Succeeded,
</span></span><span style="display:flex;"><span>    Delivered,
</span></span><span style="display:flex;"><span>    Failed_RecipientNotIdentified
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Send value. In function/proc cast to custom type e.g. _result::emailnotificationresulttype</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>pgcom.Parameters.AddWithValue(NpgsqlDbType.Text, EmailNotificationResultType.Succeeded.ToString());
</span></span></code></pre></div><ul>
<li>Receive value. In function/proc cast to text e.g. result::text</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>EmailNotificationResultType result = reader.GetValue&lt;EmailNotificationResultType&gt;(<span style="color:#f1fa8c">&#34;result&#34;</span>);
</span></span></code></pre></div><h2 id="todo">TODO</h2>
<h3 id="statistics">Statistics</h3>
<h3 id="user-priveliges">User priveliges</h3>
<h3 id="connection-pooling">Connection pooling</h3>


<footer class=" footline" >
	
</footer>


                </div>
              </div>
              
              
            </div><div id="top-github-link">
                  <a class="" href="https://github.com/altinn/altinn-studio-docs/blob/master/content/community/contributing/handbook/postgres/best-practice-postgresql.md" target="blank">
                    <i class="fa fa-code-fork"></i>
                    Endre denne siden i GitHub
                  </a>
                </div></section>
        </div> 
        <div class="col-md-2 d-none d-md-block">
          <div class="toc-container">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#client-library">Client library</a></li>
    <li><a href="#commands-npgsql">Commands (Npgsql)</a></li>
    <li><a href="#parameters">Parameters</a></li>
    <li><a href="#functions-stored-procedures">Functions (Stored Procedures)</a></li>
    <li><a href="#prepared-statements">Prepared statements</a></li>
    <li><a href="#analyze-queries">Analyze queries</a>
      <ul>
        <li><a href="#analyze-sql-statement">Analyze sql statement</a></li>
        <li><a href="#analyze-procedure-or-function">Analyze procedure or function</a></li>
        <li><a href="#index-analysis">Index analysis</a></li>
      </ul>
    </li>
    <li><a href="#json-usage">Json usage</a>
      <ul>
        <li><a href="#json-as-db-parameter">Json as db parameter</a>
          <ul>
            <li><a href="#input-parameter-example">Input parameter example</a></li>
            <li><a href="#output-parameter-example">Output parameter example</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#db-columns-with-code-values-logical-enums">DB columns with code values (logical enums)</a>
      <ul>
        <li><a href="#custom-data-type-enum-in-the-database">Custom data type (enum) in the database</a></li>
      </ul>
    </li>
    <li><a href="#todo">TODO</a>
      <ul>
        <li><a href="#statistics">Statistics</a></li>
        <li><a href="#user-priveliges">User priveliges</a></li>
        <li><a href="#connection-pooling">Connection pooling</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
        </div>
      </div> 
    </div>
    </div> <footer class="adocs-footer">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ul>
                    <li>
                        <a href="https://www.altinn.no/om-altinn/">Om Altinn</a>
                    </li>
                    <li>
                        <a href="https://github.com/Altinn/altinn-studio/issues">Backlog</a>
                    </li>
                    <li>
                        <a href="https://digdir-samarbeid.slack.com">Slack</a>
                    </li>
                    <li>
                        <a href="https://github.com/Altinn">GitHub</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js"></script>
    <script src="/js/altinninfoportal.js"></script>
    <script src="/js/altinndocs.js"></script>
    <script src="/js/altinndocs-learn.js"></script>
    <script src="/js/stickysidebar/rAF.js"></script>
    <script src="/js/stickysidebar/ResizeSensor.js"></script>
    <script src="/js/stickysidebar/sticky-sidebar.js"></script>

    <style>
      #TableOfContents {overflow-x: visible; overflow-y: scroll; scrollbar-width: none; -ms-overflow-style: none;}
      #TableOfContents::-webkit-scrollbar {display: none;  }
      #TableOfContents > ul > li {margin-top: 0.8em !important; list-style-type:none; list-style-position:inside;}
      #TableOfContents li li {margin-left: 0.4em; list-style-type:circle;}
      #TableOfContents li li:has(a.text-active) {list-style-type:disc;}
      #TableOfContents a {border-bottom: 2px solid transparent;}
      #TableOfContents a.text-active, #TableOfContents a:hover {border-bottom: 2px solid #1EAEF7;}
    </style>
    <script>
      
      class Scroller {
        static init() {
          if(document.querySelector('#TableOfContents')) {
            this.tocLinks = document.querySelectorAll('#TableOfContents a');
            this.headers = Array.from(this.tocLinks).map(link => {
              var s = link.href.split('#')[1];
              s = s.replace(/%C3%A6/g, "Ã¦");
              s = s.replace(/%C3%B8/g, "Ã¸");
              s = s.replace(/%C3%A5/g, "Ã¥");

              return document.getElementById(s);
            })
            this.ticking = false;
            window.addEventListener('scroll', (e) => {
              this.onScroll()
            })
          }
        }

        static onScroll() {
          if(!this.ticking) {
            requestAnimationFrame(this.update.bind(this));
            this.ticking = true;
          }
        }

        static update() {
          this.activeHeader ||= this.headers[0];
          let activeIndex = this.headers.findIndex((header) => {
            if (header != null) {
              return header.getBoundingClientRect().top > 180;
            }
          });
          if(activeIndex == -1) {
            activeIndex = this.headers.length - 1;
          } else if(activeIndex > 0) {
            activeIndex--;
          }
          let active = this.headers[activeIndex];
          if(active !== this.activeHeader) {
            this.activeHeader = active;
            this.tocLinks.forEach(link => link.classList.remove('text-active'));
            this.tocLinks[activeIndex].classList.add('text-active');
          }
          this.ticking = false;
        }
      }

      var a = new StickySidebar('#sidebar', {
        topSpacing: 20,
        bottomSpacing: 60,
        containerSelector: '.adocs-scrollcontainer',
        innerWrapperSelector: '.sidebar__inner',
        minWidth: 768
      });
      if (document.getElementById("TableOfContents")) {
        var a = new StickySidebar('.toc-container', {
          topSpacing: 20,
          bottomSpacing: 60,
          containerSelector: '.adocs-scrollcontainer',
          innerWrapperSelector: '#TableOfContents',
          minWidth: 768
        });
      }
    </script>
    <link href="/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="/mermaid/mermaid.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function(e) { Scroller.init();});
      mermaid.initialize({startOnLoad:true});
    </script>
<script src="/js/custom.js"></script></body>
</html>
