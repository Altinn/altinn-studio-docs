<!DOCTYPE html>
<html lang="nb" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="En applikasjon kan konsumere åpne og lukkede API som er tilgjengelig via Internett.">

<title>Konsumere APIer i en app – Altinn</title><link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/horsey.css" rel="stylesheet">
    <link href="/css/fortawesome.css" rel="stylesheet">
    <link href="/css/designsystem.css" rel="stylesheet"><link href="/css/theme.css" rel="stylesheet"><script src="/js/jquery-2.x.min.js"></script>
<link href="/css/custom.css" rel="stylesheet">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114303148-1"></script>
<script>
var host = window.location.hostname;
if(host != "localhost")
{
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-114303148-1', { 'anonymize_ip': true });
}
</script><style>
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>
  </head>
  <body class="a-page" data-url="/nb/app/development/api/consume/"><nav class="a-jumpnav">
  <ul class="no-decoration d-flex">
    <li><a class="sr-only sr-only-focusable" href="#content">Hopp til hovedinnholdet</a></li><li><a class="sr-only sr-only-focusable" href="#docsmenu">Hopp til hovedmeny</a></li></ul>
</nav>

<header class="a-header ">
  
  <div class="container">
    <div class="row">
      <div class="col-12">

        
        <nav class="a-globalNav " id="primary-nav">
          <a href="/nb/" class="a-globalNav-logo">
            <img src="/images/altinnstudio-logo-white.svg" alt="Altinn Studio logo" class="adocs-logo">
            <span class="sr-only">Til forsiden</span>
          </a>

          <button class="navbar-toggler d-md-none" type="button"><span class="sr-only">Vis/skjul meny</span></button>
          <div class="collapse navbar-toggleable-sm a-globalNav-main" id="exCollapsingNavbar2">
            <ul id="exCollapsingNavbar">
              <li class="d-md-none dropdown"><a class="nav-link dropdown-toggle a-languageSwitcher" aria-expanded="false" data-toggle="dropdown" aria-haspopup="true" href="#">
  Language
</a>
<div class="dropdown-menu a-dropdown-languages a-dropdownTriangle"><a aria-hidden="true" class="dropdown-item" href="/app/development/api/consume/">
      <img src="/images/en.svg" class="a-iconLeft a-flag" alt="" />
      <p>
        <span class="a-h3">English</span><br><span>Most content is available in english.</span></p>
    </a><a aria-hidden="true" class="dropdown-item" href="/nb/app/development/api/consume/">
      <img src="/images/nb.svg" class="a-iconLeft a-flag" alt="" />
      <p>
        <span class="a-h3">Bokmål ✓</span><br><span>Noe innhold er tilgjengelig på bokmål.</span></p>
    </a></div>
</li>
              <li>
                <a class="a-nav-link a-hvr-underline" href="/nb/app/">apps</a>
              </li>
              <li>
                <a class="a-nav-link a-hvr-underline" href="/nb/api/">api</a>
              </li>
              <li>
                <a class="a-nav-link a-hvr-underline" href="/nb/community/">community</a>
              </li>
              <li>
                <a class="a-nav-link a-hvr-underline " href="/nb/technology/">tech</a>
              </li>
            </ul>
          </div>

        </nav> 
        <ul class="nav nav-pills a-header-options" id="nav-list">
          <li class="nav-item dropdown d-none d-md-block"><a class="nav-link dropdown-toggle a-languageSwitcher" aria-expanded="false" data-toggle="dropdown" aria-haspopup="true" href="#">
  Language
</a>
<div class="dropdown-menu a-dropdown-languages a-dropdownTriangle"><a aria-hidden="true" class="dropdown-item" href="/app/development/api/consume/">
      <img src="/images/en.svg" class="a-iconLeft a-flag" alt="" />
      <p>
        <span class="a-h3">English</span><br><span>Most content is available in english.</span></p>
    </a><a aria-hidden="true" class="dropdown-item" href="/nb/app/development/api/consume/">
      <img src="/images/nb.svg" class="a-iconLeft a-flag" alt="" />
      <p>
        <span class="a-h3">Bokmål ✓</span><br><span>Noe innhold er tilgjengelig på bokmål.</span></p>
    </a></div>
</li>
        </ul>
      </div>
    </div> 
  </div> 
</header>
<div class="container pt-2 pt-md-3 pt-lg-5">
      <div class="adocs-scrollcontainer">
        <div class="row">
            <div class="col-sm-12"><nav id="sidebar" class=""><div class="highlightable">
    <div id="header-wrapper"><div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Søk...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script src="/js/lunr.min.js"></script>
<script src="/js/horsey.js"></script>
<script>
    var baseurl = "https:\/\/docs.altinn.studio\/";
</script>
<script src="/js/search.js"></script></div>
    <ul id="docsmenu" class="topics">
      <li class="dd-item">
        <a href="/nb/app/"><span>Lage apper</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/getting-started/"><span>Kom i gang</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/getting-started/intro/"><span>Introduksjon</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/first-time-setup/"><span>Opprette bruker</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/dashboard/"><span>Dashboard</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/copy-app/"><span>Kopier app</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/create-app/"><span>Opprette app</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/migrate-services/"><span>Migrere tjenester</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/navigation/"><span>Navigasjon</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/getting-started/navigation/designer/"><span>Designer</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/getting-started/navigation/designer/ui-editor/"><span>UI editor</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/navigation/repos/"><span>Repos</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/navigation/code/"><span>Code</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/access-management/"><span>Tilganger</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/getting-started/access-management/apps/"><span>Apps</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/access-management/studio/"><span>Studio</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/getting-started/local-dev/"><span>Lokal utvikling</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/"><span>Introkurs</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/case/"><span>Case</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/modul1/"><span>Modul 1</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/modul2/"><span>Modul 2</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/modul3/"><span>Modul 3</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/modul4/"><span>Modul 4</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/modul5/"><span>Modul 5</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/modul6/"><span>Modul 6</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/modul7/"><span>Modul 7</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/app-dev-course/losningsforslag/"><span>Løsningsforslag</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/design/"><span>Design</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/design/insight/"><span>Innsiktsfase</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/prototype/"><span>Prototype</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/usertest/"><span>Brukertest</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/"><span>Retningslinjer</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/design-principles/"><span>Designprinsipper</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/link-to-app/"><span>Inngang til skjema</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/content/"><span>Innhold i skjema</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/consistency/"><span>Konsistens</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/"><span>UI-komponenter</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/title-and-paragraph/"><span>Tittel og avsnitt</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/button/"><span>Knapp og lenke</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/input/"><span>Input</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/date/"><span>Dato</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/checkbox/"><span>Avkrysningsboks</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/radiobutton/"><span>Radioknapp</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/select/"><span>Nedtrekksliste</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/helptext/"><span>Hjelpetekst</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/error-message/"><span>Feilmeldinger</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/file-upload/"><span>Filopplasting</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/components/picture-component/"><span>Bilde</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/tone-of-voice/"><span>Språk</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/design/guidelines/wcag/"><span>Tilgjengelighet</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/"><span>Utvikling</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/data/"><span>Data</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/data/data-model/"><span>Datamodell</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/data/prefill/"><span>Preutfylling</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/data/options/"><span>Kodelister</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/data/attachments/"><span>Vedlegg</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/"><span>Brukergrensesnitt</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/ux/components/"><span>Komponenter</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/ux/components/panel/"><span>Panel</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/components/printbutton/"><span>PrintButton</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/components/likert/"><span>Likert</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/pages/"><span>Sider</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/ux/pages/navigation/"><span>Navigasjon</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/pages/tracks/"><span>Sporvalg</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/pages/summary/"><span>Oppsummering</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/pages/layout-sets/"><span>Flere skjema</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/fields/"><span>Felter</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/ux/fields/grouping/"><span>Gruppering</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/ux/fields/grouping/setup/"><span>Oppsett</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/fields/grouping/repeating/"><span>Repeterende</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/fields/grouping/alternatives/"><span>Innstillinger</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/fields/settings/"><span>Innstillinger</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/styling/"><span>Styling</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/images/"><span>Bilder</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/texts/"><span>Tekster</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/ux/texts/translation/"><span>Oversettelse av tekster</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/pdf/"><span>PDF</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/ux/widgets/"><span>Widgets</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/logic/"><span>Logikk</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/logic/generic/"><span>Generelt</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/logic/services/"><span>Tjenester</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/logic/dataprocessing/"><span>Dataprosessering</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/logic/dynamic/"><span>Dynamikk</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/logic/instantiation/"><span>Instansiering</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/logic/calculation/"><span>Kalkuleringer</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/logic/validation/"><span>Validering</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/"><span>Konfigurasjon</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/messagebox/"><span>Meldingsboks</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/messagebox/presentationfields/"><span>Presentasjonsfelter</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/messagebox/hide_instances/"><span>Skjule instanser</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/authorization/"><span>Autorisasjon</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/authorization/rules/"><span>Regelbibliotek</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/partytype/"><span>Aktørtyper</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/datafields/"><span>Datafelter</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/process/"><span>Prosess</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/process/auto-delete/"><span>Automatisk sletting</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/process/message/"><span>Melding</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/process/customize/"><span>Tilpasse visninger</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/queryparameters/"><span>Query parametere</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/secrets/"><span>Secrets</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/eformidling/"><span>eFormidling</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/events/"><span>Events</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/settings/"><span>Settings</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/startup/"><span>Startup</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/stateless/"><span>Stateless</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/deployment/"><span>Deployment</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/configuration/authentication/"><span>Autentisering</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/development/api/"><span>API</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/development/api/expose/"><span>Eksponere</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/api/instance/"><span>Instans</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/development/api/consume/"><span>Konsumere</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/testing/"><span>Testing</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/testing/local/"><span>Lokalt</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/testing/local/apitests/"><span>API tests</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/testing/local/apitests/org/"><span>Org</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/testing/local/apitests/user/"><span>Sluttbruker</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/testing/local/debug/"><span>Debugging</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/testing/local/testusers/"><span>Testbrukere</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/testing/deploy/"><span>I testmiljø</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/deployment/"><span>Produksjonssetting</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/deployment/runtime-environment/"><span>Kjøremiljø</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/deployment/runtime-environment/resource-allocation/"><span>Ressurserfordeling</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/deployment/runtime-environment/resource-allocation-tips/"><span>Tips til ressurserfordeling</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/maintainance/"><span>Vedlikehold</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/maintainance/dependencies/"><span>Avhengigheter</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/app/launched-apps/"><span>Lanserte tjenester</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/launched-apps/digdir/"><span>Digdir</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/app/launched-apps/digdir/bli-tjenesteeier/"><span>Bli tjenesteeier</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/launched-apps/digdir/godkjenn-bruksvilkaar/"><span>Godkjenn bruksvilkår</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/launched-apps/digdir/oed/"><span>Oppgjør etter dødsfall</span></a></li>
      <li class="dd-item">
        <a href="/nb/app/launched-apps/digdir/be-om-api-nokkel/"><span>Tilgang til REST API</span></a></li></ul></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/api/"><span>API</span><i class="fa fa-sort-down fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/api/apps/"><span>App</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/api/apps/metadata/"><span>Metadata</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/apps/instances/"><span>Instanser</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/apps/data-elements/"><span>Data-elementer</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/api/apps/data-elements/tags/"><span>Tags</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/api/apps/stateless-data-elements/"><span>Tilstandsløse data</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/apps/process/"><span>Prosess</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/apps/validation/"><span>Validering</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/apps/spec/"><span>OpenAPI</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/api/authentication/"><span>Authentication</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/api/authentication/maskinporten/"><span>Maskinporten</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/authentication/enterpriseuser/"><span>Virksomhetsbruker</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/authentication/id-porten/"><span>ID-porten</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/authentication/delegate-scopes/"><span>Delegere API-tilganger</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/authentication/spec/"><span>OpenAPI</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/api/events/"><span>Events</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/api/events/spec/"><span>OpenAPI</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/api/models/"><span>Modeller</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/api/models/app-metadata/"><span>App metadata</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/models/instance/"><span>Instance</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/models/data-element/"><span>DataElement</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/api/scenarios/"><span>Scenarier</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/api/scenarios/authentication/"><span>Autentisering</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/api/storage/"><span>Storage</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/api/storage/instances/"><span>Instanser</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/storage/instance-events/"><span>Instance events</span></a></li>
      <li class="dd-item">
        <a href="/nb/api/storage/spec/"><span>OpenAPI</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/api/studio/"><span>Studio</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/"><span>Community</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/about/"><span>Om</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/about/open-source/"><span>Åpen kildekode</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/about/goals/"><span>Mål</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/"><span>Bidra til utvikling</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/contributing/propose-component/"><span>Foreslå en ny komponent</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/develop-component/"><span>Utvikle en komponent</span></a></li><li class="dd-item">
          <a href="/nb/community/contributing/intro/">
            <span>Intro for utviklere</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/contributing/handbook/"><span>Håndbok</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/"><span>Endringslogg</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/"><span>App frontend</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/v3/"><span>v3</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/v3/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-frontend/v3/whats-new/"><span>Hva er nytt?</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/"><span>App nuget</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v6/"><span>v6</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v6/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v6/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v5/"><span>v5</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v5/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v5/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v4/"><span>v4</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v4/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v4/whats-new/"><span>Hva er nytt?</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v3/"><span>v3</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v3/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/app-nuget/v3/whats-new/"><span>Hva er nytt?</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/"><span>Deployment</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/migration/"><span>Migrering</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v1/"><span>v1</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v1/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v1/whats-new/"><span>Hva er nytt</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v2/"><span>v2</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v2/breaking-changes/"><span>Breaking changes</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/deployment/v2/whats-new/"><span>Hva er nytt</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/storage-interfaces/"><span>Storage Interface</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/changelog/storage-interfaces/v3/"><span>v3</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/changelog/storage-interfaces/v2/"><span>v2</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/roadmap/"><span>Roadmap</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/roadmap/studio/"><span>Studio</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/roadmap/studio/appowner/"><span>App-eier</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/roadmap/studio/enduser/"><span>Sluttbruker</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/devops/"><span>DevOps</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/devops/definition-of-ready/"><span>Definition of Ready</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/roadmapprocess/"><span>Roadmap prosess</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/"><span>Teams</span><i class="fa fa-caret-right fa-lg category-icon"></i></a><ul>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/apps/"><span>Apps</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/platform/"><span>Platform</span></a></li>
      <li class="dd-item">
        <a href="/nb/community/devops/teams/studio/"><span>Studio</span></a></li></ul></li></ul></li>
      <li class="dd-item">
        <a href="/nb/community/presentations/"><span>Presentasjoner</span></a></li></ul></li>
      <li class="dd-item">
        <a href="/nb/technology/"><span>Teknologi</span></a></li></ul>
  </div>
</nav>

<script>
          $("li.dd-item a[href='/nb/app/']").parent().addClass("parent");
 $("li.dd-item a[href='/nb/app/development/']").parent().addClass("parent");
 $("li.dd-item a[href='/nb/app/development/api/']").parent().addClass("parent");
 $("li.dd-item a[href='/nb/app/development/api/consume/']").parent().addClass("active");
        </script>
        <section id="body">
          <div id="content" class="adocs-content js-moveChildrenTo">
        <div id="overlay"></div>
        <div class="a-text"><div id="top-bar">
            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span" class="adocs-sidebarToggle">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                    <span class="sr-only">Vis/skjul meny</span>
                  </a>
                </span>
                <span class="links"><a href='/nb/app/'>Lage apper</a> <span class='adocs-breadcrumb-divider'> / </span> <a href='/nb/app/development/'>Utvikling</a> <span class='adocs-breadcrumb-divider'> / </span> <a href='/nb/app/development/api/'>API</a> <span class='adocs-breadcrumb-divider'> / </span> Konsumere</span>
            </div>
          </div><div id="body-inner"><h1 class="a-fontBold">Konsumere APIer i en app</h1>
              <p class="a-leadText" id="leadText">En applikasjon kan konsumere åpne og lukkede API som er tilgjengelig via Internett.</p><h2>På denne siden:</h2><nav id="TableOfContents">
  <ul>
    <li><a href="#opprettelse-av-api-modeller">Opprettelse av API modeller</a></li>
    <li><a href="#oppsett-av-interface-for-klienten">Oppsett av interface for klienten</a></li>
    <li><a href="#implementere-klient">Implementere klient</a></li>
    <li><a href="#registrere-klienten-i-applikasjonen">Registrere klienten i applikasjonen</a></li>
    <li><a href="#benytte-klient-i-applikasjonslogikk">Benytte klient i applikasjonslogikk</a></li>
    <li><a href="#caching-av-responsdata">Caching av responsdata</a></li>
  </ul>
</nav><p>ASP.NET Core har gode muligheter til å konsumere API.</p>
<p>Dette kan være nyttig dersom man ønsker å eksponere organisasjonens
egne API via en app eller har behov for data fra eksterne API i appen.</p>
<p>På denne siden går vi gjennom et eksempel hvor et eksternt, åpent API benyttes til å berrike skjemadata.
<a href="https://altinn.studio/repos/ttd/consume-api-example">Eksempelappen kan sees i sin helhet i Altinn Studio</a>.</p>
<p>APIet som benyttes er <a href="https://restcountries.com/#api-endpoints-v3">RestCountries v3</a> og det er 
endepunktet <code>https://restcountries.com/v3.1/name/{country}</code> vi er interessert i. 
Dette returnerer et sett med detaljer om landet som er oppgitt.</p>
<p>Du kan studere responsen ved å kalle APIet fra nettleseren din: <a href="https://restcountries.com/v3.1/name/Norway">https://restcountries.com/v3.1/name/Norway</a>.</p>
<p>Vi ønsker å berrike skjemaet med detaljer om et land som sluttbruker har fylt inn.</p>
<h2 id="opprettelse-av-api-modeller">Opprettelse av API modeller</h2>
<p>Dersom API-et som skal konsumeres er dokumentert med Swagger eller OpenAPI kan man enkelt genere C# klasser basert på datamodellen.
Dette kan gjøres manuelt eller ved hjelp av verktøy som tilbyr slik generering.</p>
<p>I dette eksempelet er responsobjektet stort og inneholder langt mer data enn den vi er interessert i.</p>
<p>Her er et lite utklipp av responsobjektet for Norge.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;name&#34;</span>: {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">&#34;common&#34;</span>: <span style="color:#f1fa8c">&#34;Norway&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">&#34;official&#34;</span>: <span style="color:#f1fa8c">&#34;Kingdom of Norway&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">&#34;nativeName&#34;</span>: {}
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;idd&#34;</span>: {},
</span></span><span style="display:flex; background-color:#3d3f4a"><span>		<span style="color:#ff79c6">&#34;capital&#34;</span>: [
</span></span><span style="display:flex; background-color:#3d3f4a"><span>			<span style="color:#f1fa8c">&#34;Oslo&#34;</span>
</span></span><span style="display:flex; background-color:#3d3f4a"><span>		],
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;altSpellings&#34;</span>: [],
</span></span><span style="display:flex; background-color:#3d3f4a"><span>		<span style="color:#ff79c6">&#34;region&#34;</span>: <span style="color:#f1fa8c">&#34;Europe&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;subregion&#34;</span>: <span style="color:#f1fa8c">&#34;Northern Europe&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;languages&#34;</span>: {},
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;translations&#34;</span>: {},
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;latlng&#34;</span>: [
</span></span><span style="display:flex;"><span>			<span style="color:#bd93f9">62</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#bd93f9">10</span>
</span></span><span style="display:flex;"><span>		],
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;landlocked&#34;</span>: <span style="color:#ff79c6">false</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;borders&#34;</span>: [],
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;area&#34;</span>: <span style="color:#bd93f9">323802</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;demonyms&#34;</span>: {},
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;flag&#34;</span>: <span style="color:#f1fa8c">&#34;🇳🇴&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;maps&#34;</span>: {},
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;population&#34;</span>: <span style="color:#bd93f9">5379475</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">&#34;postalCode&#34;</span>: {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">&#34;format&#34;</span>: <span style="color:#f1fa8c">&#34;###&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">&#34;regex&#34;</span>: <span style="color:#f1fa8c">&#34;^(\\d{4})$&#34;</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>I applikasjonen ønsker vi kun å ta med oss dataen på de markerte linjene, altså hovedstad og region.
Vi lager et minimalistisk responsobjekt som kun inneholder de feltene vi er interessert i.</p>
<p>I mappen <em>App/models</em> opprettes det en ny fil <code>Country.cs</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Collections.Generic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">namespace</span> Altinn.App.models
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">public</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Country</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">public</span> List&lt;<span style="color:#8be9fd">string</span>&gt; Capital { <span style="color:#ff79c6">get</span>; <span style="color:#ff79c6">set</span>; }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">public</span> <span style="color:#8be9fd">string</span> Region { <span style="color:#ff79c6">get</span>; <span style="color:#ff79c6">set</span>; }  
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Country</code>-objektet består av feltene <code>Capital</code> og <code>Region</code>.
<code>Capital</code> er en liste med strenger, da et land kan ha flere hovesteder.</p>
<p>I dette eksempelt krever ikke APIet et komplekst request-objekt og dermed kan vi nøye oss med den ene modellen.
Skulle det være behov for et request-objekt kan dette opprettes på samme måte.</p>
<h2 id="oppsett-av-interface-for-klienten">Oppsett av interface for klienten</h2>
<p>Det anbefales at det defineres et interface for klienten som skal kalle API. 
Det gjør at vi kan benytte oss av styrkene til .NET med dependency injection og effektiv håndtering av HTTP-klienter.</p>
<p>I applikasjonsrepoet opprettes mappen <em>App/clients</em>,
i den nye mappen opprettes filen <code>ICountryClient.cs</code>.</p>
<p>Interfaces består av én metode <code>GetCountry</code> som tar inn en streng og returnerer et <em>Country</em>-objekt.</p>
<p>Definer interfacet som vist nedenfor.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Threading.Tasks;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Altinn.App.models;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">namespace</span> Altinn.App.client
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">public</span> <span style="color:#ff79c6">interface</span> <span style="color:#50fa7b">ICountryClient</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/// Retrieves metadata about the provided country.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/// &lt;param name=&#34;country&#34;&gt;The name of the country&lt;/param&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/// &lt;returns&gt;A country object&lt;/returns&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">public</span> Task&lt;Country&gt; GetCountry(<span style="color:#8be9fd">string</span> country);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Returobjektet er omkranset av <code>Task&lt;...&gt;</code> denne er lagt inn for å vise til at kallet som skal gjøres
vil være asynkront.</p>
<h2 id="implementere-klient">Implementere klient</h2>
<p>Det er klienten som inneholder koden som gjør kallet mot APIer og omformer resultatet til <code>Country</code>-modellen 
som forventes i retur av funksjonene som kaller klienten.</p>
<p>Den fulle implementasjonen av <em>Country</em>-klienten er vist nedenfor.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Collections.Generic;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Linq;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Net.Http;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Text.Json;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Threading.Tasks;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Altinn.App.models;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Microsoft.Extensions.Logging;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">namespace</span> Altinn.App.client
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">public</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CountryClient</span> : ICountryClient
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        HttpClient _client;
</span></span><span style="display:flex;"><span>        ILogger&lt;ICountryClient&gt; _logger;
</span></span><span style="display:flex;"><span>        JsonSerializerOptions _serializerOptions;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">public</span> CountryClient(HttpClient client, ILogger&lt;ICountryClient&gt; logger)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            _logger = logger;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            _client = client;
</span></span><span style="display:flex;"><span>            _client.BaseAddress = <span style="color:#ff79c6">new</span> Uri(<span style="color:#f1fa8c">&#34;https://restcountries.com/v3.1&#34;</span>);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            _serializerOptions = <span style="color:#ff79c6">new</span>()
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                PropertyNameCaseInsensitive = <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">public</span> <span style="color:#ff79c6">async</span> Task&lt;Country&gt; GetCountry(<span style="color:#8be9fd">string</span> country)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd">string</span> query = <span style="color:#f1fa8c">$&#34;name/{country}&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            HttpResponseMessage res = <span style="color:#ff79c6">await</span> _client.GetAsync(query);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (res.IsSuccessStatusCode)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#8be9fd">string</span> resString = <span style="color:#ff79c6">await</span> res.Content.ReadAsStringAsync();
</span></span><span style="display:flex;"><span>               
</span></span><span style="display:flex;"><span>                List&lt;Country&gt; countryResponse = JsonSerializer.Deserialize&lt;List&lt;Country&gt;&gt;(resString, _serializerOptions);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> countryResponse.Any() ? countryResponse.First() : <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                _logger.LogError(<span style="color:#f1fa8c">&#34;Retrieving country {country} failed with status code {statusCode}&#34;</span>, country, res.StatusCode);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Øverst i filen finner du referansen til alle namespace som klassen er avhengig av</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Linq;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Net.Http;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Text.Json;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Threading.Tasks;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Altinn.App.models;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Microsoft.Extensions.Logging;
</span></span></code></pre></div><p>Videre definerer vi klassen og hvilket interface den arver fra</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">public</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CountryClient</span> : ICountryClient
</span></span></code></pre></div><p>Videre er tre private objekter _<em>client</em>, __logger og _<em>serializerOptions</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> HttpClient _client;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> ILogger&lt;ICountryClient&gt; _logger;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> JsonSerializerOptions _serializerOptions;
</span></span></code></pre></div><p>Understrek foran navnet er kun en navnekonvensjon og har ingen effekt.</p>
<ul>
<li>_<em>client</em> vil i konstruktøren populeres med en http-klient.</li>
<li>_<em>logger</em> vil i konstruktøren populeres med en logger slik at man kan logge feilmeldinger og annet i klassen</li>
<li>_<em>serializerOptions</em> vil i konstruktøren instansieres og konfigureres for å kunne deserialisere responsen fra APIet.</li>
</ul>
<p>Videre i klassen defineres konstruktøren.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">public</span> CountryClient(HttpClient client, ILogger&lt;ICountryClient&gt; logger)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>      _logger = logger;
</span></span><span style="display:flex;"><span>      _client = client;
</span></span><span style="display:flex;"><span>      _client.BaseAddress = <span style="color:#ff79c6">new</span> Uri(<span style="color:#f1fa8c">&#34;https://restcountries.com/v3.1&#34;</span>);
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      _serializerOptions = <span style="color:#ff79c6">new</span>()
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>          PropertyNameCaseInsensitive = <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Objekter populeres dersom de kommer som input i konstruktøren og andre objekter instansieres.
Skulle du ha behov for å bruke en av de andre servicene som er registeret i applikasjonen er det bare å
sende den inn i konstruktøren og opprette et privat objekt for å kunne ta det i bruk i klassen slik vi har gjort
med _<em>logger</em>  eller _<em>client</em>.</p>
<p>Videre i klassen finner du implementasjonen av metoden <code>GetCountry</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">public</span> <span style="color:#ff79c6">async</span> Task&lt;Country&gt; GetCountry(<span style="color:#8be9fd">string</span> country)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">string</span> query = <span style="color:#f1fa8c">$&#34;name/{country}&#34;</span>;
</span></span><span style="display:flex;"><span>    HttpResponseMessage res = <span style="color:#ff79c6">await</span> _client.GetAsync(query);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (res.IsSuccessStatusCode)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">string</span> resString = <span style="color:#ff79c6">await</span> res.Content.ReadAsStringAsync();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List&lt;Country&gt; countryResponse = JsonSerializer.Deserialize&lt;List&lt;Country&gt;&gt;(resString, _serializerOptions);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> countryResponse.Any() ? countryResponse.First() : <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _logger.LogError(<span style="color:#f1fa8c">&#34;Retrieving country {country} failed with status code {statusCode}&#34;</span>, country, res.StatusCode);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Her gjøres det en sjekk på at statuskoden på API-kallet er en suksess-kode før vi deserialiseres og returnerer objektet.
Dersom det ikke er en suksess-statuskode logger vi en feil og returnerer null.</p>
<h2 id="registrere-klienten-i-applikasjonen">Registrere klienten i applikasjonen</h2>
<p>Når interface og klient er implementert kan den registreres i <em>App/Program.cs</em> (.NET 6) eller i <em>App/Startup.cs</em> (.NET 5) for bruk i applikasjonen.</p>
<p>I metoden <code>ConfigureServices</code> legger vi til kodelinjen nedenfor</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>services.AddHttpClient&lt;ICountryClient, CountryClient&gt;();
</span></span></code></pre></div><h2 id="benytte-klient-i-applikasjonslogikk">Benytte klient i applikasjonslogikk</h2>
<p>For å berrike skjemadata må vi koble klienten vår på logikken i <em>App/logic/DataProcessingHandler.cs</em> i metoden <em>ProcessDataWrite</em>.</p>
<p>Først må klienten tilgjengeliggjøres ved å <em>injecte</em> den inn i konstruktøren til klassen.
DataProcessingHandler har ingen konstruktør i utgangspunktet så den må opprettes i klasse.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span> <span style="color:#ff79c6">public</span> DataProcessingHandler()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Videre kan vi opprette et privat objekt for klienten, injecte den i konstruktøren og assigne den til det private objektet. 
Resultatet blir seende slik ut:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> ICountryClient _countryClient;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">public</span> DataProcessingHandler(ICountryClient countryClient)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    _countryClient = countryClient;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>_<em>countryClient</em> er nå tilgjengelig i DataProcessingHandler og vi er klare til å implementere logikken i ProcessDataWrite.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">public</span> <span style="color:#ff79c6">async</span> Task&lt;<span style="color:#8be9fd">bool</span>&gt; ProcessDataWrite(Instance instance, Guid? dataId, <span style="color:#8be9fd">object</span> data)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (data.GetType() == <span style="color:#ff79c6">typeof</span>(skjema))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        skjema skjema = (skjema)data;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (!<span style="color:#8be9fd">string</span>.IsNullOrEmpty(skjema.land))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Country country = <span style="color:#ff79c6">await</span> _countryClient.GetCountry(skjema.land.Trim());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (country != <span style="color:#ff79c6">null</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                skjema.hovedstad = <span style="color:#8be9fd">string</span>.Join(<span style="color:#f1fa8c">&#34;,&#34;</span>, country.Capital);
</span></span><span style="display:flex;"><span>                skjema.region = country.Region;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                skjema.hovedstad = skjema.region = <span style="color:#8be9fd">string</span>.Empty;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            skjema.hovedstad = <span style="color:#8be9fd">string</span>.Empty;
</span></span><span style="display:flex;"><span>            skjema.region = <span style="color:#8be9fd">string</span>.Empty;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">await</span> Task.FromResult(<span style="color:#ff79c6">false</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Prøver du å bygge applikasjonen nå vil du få en feil.
DataProcessingHandler instansieres i App.cs, så alle dependecies må og inn i denne filen 
og så sendes videre i konstruktøren til DataProcessingHandler.</p>
<p>I filen <em>App/logic/App.cs</em> gjøres følgende endringer</p>
<ul>
<li>
<p>legg til en referanse til namespaces til klienten øverst i filen</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Altinn.App.client;
</span></span></code></pre></div></li>
<li>
<p><em>Inject</em> <code>ICountryClient</code> nederst i App.cs-konstruktøren.</p>
<p>Dette er gjort på linje 14.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#ff79c6">public</span> App(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    IAppResources appResourcesService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    ILogger&lt;App&gt; logger,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    IData dataService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    IProcess processService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    IPDF pdfService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    IProfile profileService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    IRegister registerService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    IPrefill prefillService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    IInstance instanceService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    IOptions&lt;GeneralSettings&gt; settings,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    IText textService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    IHttpContextAccessor httpContextAccessor,
</span></span><span style="display:flex; background-color:#3d3f4a"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    ICountryClient countryClient) : <span style="color:#ff79c6">base</span>(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>        appResourcesService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>        logger,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>        dataService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>        processService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>        pdfService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>        prefillService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>        instanceService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>        registerService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>        settings,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>        profileService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>        textService,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>        httpContextAccessor)
</span></span></code></pre></div></li>
<li>
<p>Legg til countryClient i konstruktøren til DataProcessingHandler</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span>_dataProcessingHandler = <span style="color:#ff79c6">new</span> DataProcessingHandler(countryClient);
</span></span></code></pre></div></li>
</ul>
<h2 id="caching-av-responsdata">Caching av responsdata</h2>
<p>En ulempe med eksempelet slikt det står nå er at man for hver gang skjemaet lagres vil man gjøre et kall
mot endepunktet for å hente ut data.</p>
<p>Det er rimelig å anta at et lands hovedstad og hvilken region 
det tilhører ikke vil endre seg hyppig. Har vi hentet informasjon om Norge kan vi lagre denne lokalt i applikasjonen 
i en tidsperiode, så man slipper å gjøre kallet igjen.</p>
<p>Kodeendringene beskrives ikke steg for steg, men er vist i sin helhet nedenfor. 
Det kreves kun endringer i <em>CountryClient.cs</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cs" data-lang="cs"><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Altinn.App.models;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Microsoft.Extensions.Caching.Memory;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> Microsoft.Extensions.Logging;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Collections.Generic;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Linq;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Net.Http;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Text.Json;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">using</span> System.Threading.Tasks;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">namespace</span> Altinn.App.client
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">public</span> <span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CountryClient</span> : ICountryClient
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> HttpClient _client;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> ILogger&lt;ICountryClient&gt; _logger;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> JsonSerializerOptions _serializerOptions;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> IMemoryCache _memoryCache;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">private</span> <span style="color:#ff79c6">readonly</span> MemoryCacheEntryOptions _cacheOptions;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">public</span> CountryClient(HttpClient client, ILogger&lt;ICountryClient&gt; logger, IMemoryCache memoryCache)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            _logger = logger;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            _client = client;
</span></span><span style="display:flex;"><span>            _client.BaseAddress = <span style="color:#ff79c6">new</span> Uri(<span style="color:#f1fa8c">&#34;https://restcountries.com/v3.1/&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            _serializerOptions = <span style="color:#ff79c6">new</span>()
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                PropertyNameCaseInsensitive = <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            _memoryCache = memoryCache;
</span></span><span style="display:flex;"><span>            _cacheOptions = <span style="color:#ff79c6">new</span>()
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                AbsoluteExpirationRelativeToNow = TimeSpan.FromHours(<span style="color:#bd93f9">24</span>)
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">public</span> <span style="color:#ff79c6">async</span> Task&lt;Country&gt; GetCountry(<span style="color:#8be9fd">string</span> country)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd">string</span> uniqueCacheKey = <span style="color:#f1fa8c">&#34;Country_&#34;</span> + country;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// Check if country is present in cache, if so return from cache</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (_memoryCache.TryGetValue(uniqueCacheKey, <span style="color:#ff79c6">out</span> Country outputCountry))
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> outputCountry;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd">string</span> query = <span style="color:#f1fa8c">$&#34;name/{country}&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            HttpResponseMessage res = <span style="color:#ff79c6">await</span> _client.GetAsync(query);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (res.IsSuccessStatusCode)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#8be9fd">string</span> resString = <span style="color:#ff79c6">await</span> res.Content.ReadAsStringAsync();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                List&lt;Country&gt; countryResponse = JsonSerializer.Deserialize&lt;List&lt;Country&gt;&gt;(resString, _serializerOptions);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (countryResponse.Any())
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    outputCountry = countryResponse.First();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#6272a4">// Add response country to cache</span>
</span></span><span style="display:flex;"><span>                    _memoryCache.Set(uniqueCacheKey, outputCountry, _cacheOptions);
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span> outputCountry;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                _logger.LogError(<span style="color:#f1fa8c">&#34;Retrieving country {country} failed with status code {statusCode}&#34;</span>, country, res.StatusCode);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>

<footer class=" footline" ></footer>
                </div>
              </div>
              

            </div><div id="top-github-link">
                  <a class="" href="https://github.com/altinn/altinn-studio-docs/blob/master/content/app/development/api/consume/_index.nb.md" target="blank">
                    <i class="fa fa-code-fork"></i>
                    Endre denne siden i GitHub
                  </a>
                </div></section>
        </div> 
      </div> 
    </div>
    </div> <footer class="adocs-footer">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ul>
                    <li>
                        <a href="https://www.altinn.no/om-altinn/">Om Altinn</a>
                    </li>
                    <li>
                        <a href="https://github.com/Altinn/altinn-studio/issues">Backlog</a>
                    </li>
                    <li>
                        <a href="https://altinn.slack.com">Slack</a>
                    </li>
                    <li>
                        <a href="https://github.com/Altinn/altinn-studio">GitHub</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js"></script>
    <script src="/js/altinninfoportal.js"></script>
    <script src="/js/altinndocs.js"></script>
    <script src="/js/altinndocs-learn.js"></script>
    <script src="/js/stickysidebar/rAF.js"></script>
    <script src="/js/stickysidebar/ResizeSensor.js"></script>
    <script src="/js/stickysidebar/sticky-sidebar.js"></script>

    <script>
      var a = new StickySidebar('#sidebar', {
        topSpacing: 20,
        bottomSpacing: 60,
        containerSelector: '.adocs-scrollcontainer',
        innerWrapperSelector: '.sidebar__inner',
        minWidth: 768
      });
    </script>
    <link href="/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="/mermaid/mermaid.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
<script src="/js/custom.js"></script></body>
</html>

